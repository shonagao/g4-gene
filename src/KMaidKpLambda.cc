/*
Kaon MAID 
http://wwwkph.kph.uni-mainz.de/MAID//kaon/
*/

#include "KMaidKpLambda.hh"

#include <iostream>
#include <cmath>

const double KMaidKpLambda::Wtbl[33] = { // invariant energy [GeV]
  1.609, 1.620, 1.640, 1.650, 1.660, 1.670, 1.680, 1.690, 1.700, 1.710,
  1.720, 1.730, 1.740, 1.750, 1.760, 1.770, 1.780, 1.790, 1.800, 1.820,
  1.840, 1.870, 1.900, 1.930, 1.960, 1.990, 2.020, 2.050, 2.080, 2.110,
  2.140, 2.170, 2.200
};

const double KMaidKpLambda::Costtbl[37] = { // cos(theta_CM)
  +1.00000, +0.99619, +0.98481, +0.96593, +0.93969, +0.90631, +0.86603, +0.81915, +0.76604, +0.70711,
  +0.64279, +0.57358, +0.50000, +0.42262, +0.34202, +0.25882, +0.17365, +0.08716, +0.00000, -0.08716,
  -0.17365, -0.25882, -0.34202, -0.42262, -0.50000, -0.57358, -0.64279, -0.70711, -0.76604, -0.81915,
  -0.86603, -0.90631, -0.93969, -0.96593, -0.98481, -0.99619, -1.00000
};

const double KMaidKpLambda::CStbl[33][37] = { // cross section table at Q2 = 0. [muB]
  // W= 1.609 GeV
  { 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,
    0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,
    0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,
    0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000 },
  // W= 1.620 GeV
  { 0.04103, 0.04100, 0.04088, 0.04069, 0.04043, 0.04010, 0.03971, 0.03927, 0.03877, 0.03824,
    0.03768, 0.03709, 0.03649, 0.03588, 0.03527, 0.03466, 0.03407, 0.03350, 0.03295, 0.03243,
    0.03193, 0.03147, 0.03103, 0.03063, 0.03027, 0.02993, 0.02963, 0.02936, 0.02912, 0.02892,
    0.02874, 0.02859, 0.02847, 0.02837, 0.02831, 0.02827, 0.02825 },
  // W= 1.640 GeV
  { 0.10510, 0.10500, 0.10450, 0.10370, 0.10270, 0.10140, 0.09980, 0.09804, 0.09612, 0.09406,
    0.09191, 0.08971, 0.08748, 0.08528, 0.08312, 0.08103, 0.07904, 0.07717, 0.07542, 0.07380,
    0.07231, 0.07096, 0.06974, 0.06864, 0.06766, 0.06678, 0.06600, 0.06531, 0.06471, 0.06418,
    0.06373, 0.06335, 0.06304, 0.06281, 0.06263, 0.06253, 0.06250 },
  // W= 1.650 GeV
  { 0.13880, 0.13860, 0.13790, 0.13670, 0.13520, 0.13320, 0.13090, 0.12840, 0.12550, 0.12250,
    0.11940, 0.11620, 0.11290, 0.10980, 0.10670, 0.10370, 0.10090, 0.09828, 0.09586, 0.09364,
    0.09163, 0.08982, 0.08820, 0.08675, 0.08545, 0.08431, 0.08329, 0.08238, 0.08159, 0.08089,
    0.08029, 0.07978, 0.07936, 0.07903, 0.07879, 0.07865, 0.07860 },
  // W= 1.660 GeV
  { 0.17280, 0.17250, 0.17160, 0.17000, 0.16790, 0.16520, 0.16200, 0.15840, 0.15450, 0.15030,
    0.14600, 0.14160, 0.13710, 0.13280, 0.12850, 0.12450, 0.12070, 0.11720, 0.11400, 0.11110,
    0.10850, 0.10610, 0.10410, 0.10220, 0.10050, 0.09908, 0.09777, 0.09661, 0.09558, 0.09467,
    0.09387, 0.09319, 0.09262, 0.09217, 0.09184, 0.09164, 0.09158 },
  // W= 1.670 GeV
  { 0.20830, 0.20780, 0.20650, 0.20440, 0.20150, 0.19790, 0.19360, 0.18880, 0.18350, 0.17780,
    0.17190, 0.16590, 0.15990, 0.15400, 0.14830, 0.14290, 0.13780, 0.13310, 0.12890, 0.12500,
    0.12150, 0.11850, 0.11570, 0.11330, 0.11120, 0.10920, 0.10750, 0.10600, 0.10460, 0.10340,
    0.10230, 0.10140, 0.10060, 0.09999, 0.09954, 0.09926, 0.09917 },
  // W= 1.680 GeV
  { 0.24620, 0.24570, 0.24400, 0.24120, 0.23740, 0.23260, 0.22690, 0.22050, 0.21340, 0.20580,
    0.19790, 0.18980, 0.18170, 0.17380, 0.16610, 0.15880, 0.15190, 0.14560, 0.13990, 0.13470,
    0.13000, 0.12590, 0.12220, 0.11900, 0.11610, 0.11350, 0.11120, 0.10910, 0.10720, 0.10550,
    0.10400, 0.10260, 0.10150, 0.10060, 0.10000, 0.09960, 0.09947 },
  // W= 1.690 GeV
  { 0.28550, 0.28480, 0.28270, 0.27920, 0.27440, 0.26830, 0.26110, 0.25280, 0.24370, 0.23390,
    0.22360, 0.21310, 0.20250, 0.19200, 0.18190, 0.17230, 0.16320, 0.15480, 0.14720, 0.14020,
    0.13400, 0.12840, 0.12350, 0.11910, 0.11510, 0.11160, 0.10830, 0.10540, 0.10270, 0.10030,
    0.09817, 0.09628, 0.09467, 0.09338, 0.09243, 0.09186, 0.09166 },
  // W= 1.700 GeV
  { 0.32070, 0.31990, 0.31740, 0.31330, 0.30770, 0.30050, 0.29190, 0.28200, 0.27100, 0.25920,
    0.24670, 0.23370, 0.22070, 0.20770, 0.19510, 0.18300, 0.17160, 0.16100, 0.15120, 0.14240,
    0.13440, 0.12720, 0.12070, 0.11490, 0.10960, 0.10480, 0.10050, 0.09645, 0.09276, 0.08939,
    0.08634, 0.08366, 0.08137, 0.07952, 0.07816, 0.07733, 0.07705 },
  // W= 1.710 GeV
  { 0.34460, 0.34380, 0.34120, 0.33690, 0.33090, 0.32320, 0.31390, 0.30310, 0.29100, 0.27770,
    0.26360, 0.24890, 0.23400, 0.21900, 0.20440, 0.19020, 0.17680, 0.16430, 0.15270, 0.14210,
    0.13250, 0.12370, 0.11580, 0.10860, 0.10200, 0.09591, 0.09029, 0.08507, 0.08022, 0.07575,
    0.07168, 0.06805, 0.06495, 0.06244, 0.06058, 0.05945, 0.05906 },
  // W= 1.720 GeV
  { 0.35420, 0.35340, 0.35100, 0.34690, 0.34120, 0.33380, 0.32460, 0.31380, 0.30150, 0.28780,
    0.27300, 0.25750, 0.24150, 0.22530, 0.20940, 0.19390, 0.17920, 0.16530, 0.15240, 0.14050,
    0.12950, 0.11960, 0.11040, 0.10210, 0.09431, 0.08711, 0.08037, 0.07403, 0.06808, 0.06254,
    0.05745, 0.05289, 0.04897, 0.04577, 0.04341, 0.04196, 0.04147 },
  // W= 1.730 GeV
  { 0.35120, 0.35050, 0.34860, 0.34520, 0.34030, 0.33370, 0.32550, 0.31540, 0.30370, 0.29040,
    0.27580, 0.26020, 0.24400, 0.22740, 0.21090, 0.19470, 0.17920, 0.16450, 0.15080, 0.13800,
    0.12630, 0.11550, 0.10550, 0.09633, 0.08775, 0.07970, 0.07208, 0.06485, 0.05800, 0.05156,
    0.04560, 0.04023, 0.03558, 0.03178, 0.02896, 0.02722, 0.02663 },
  // W= 1.740 GeV
  { 0.33990, 0.33940, 0.33810, 0.33560, 0.33190, 0.32670, 0.31980, 0.31110, 0.30050, 0.28810,
    0.27420, 0.25910, 0.24310, 0.22660, 0.20990, 0.19360, 0.17770, 0.16260, 0.14850, 0.13530,
    0.12310, 0.11180, 0.10140, 0.09171, 0.08263, 0.07403, 0.06584, 0.05800, 0.05050, 0.04340,
    0.03678, 0.03077, 0.02554, 0.02124, 0.01804, 0.01606, 0.01540 },
  // W= 1.750 GeV
  { 0.32450, 0.32430, 0.32360, 0.32230, 0.31990, 0.31620, 0.31090, 0.30370, 0.29450, 0.28330,
    0.27030, 0.25590, 0.24030, 0.22410, 0.20760, 0.19120, 0.17530, 0.16010, 0.14580, 0.13250,
    0.12020, 0.10870, 0.09815, 0.08828, 0.07899, 0.07014, 0.06166, 0.05347, 0.04558, 0.03804,
    0.03096, 0.02449, 0.01882, 0.01414, 0.01064, 0.00847, 0.00774 },
  // W= 1.760 GeV
  { 0.30840, 0.30840, 0.30850, 0.30820, 0.30730, 0.30520, 0.30140, 0.29570, 0.28780, 0.27780,
    0.26570, 0.25190, 0.23690, 0.22090, 0.20460, 0.18840, 0.17260, 0.15740, 0.14320, 0.12990,
    0.11760, 0.10630, 0.09583, 0.08603, 0.07679, 0.06796, 0.05942, 0.05112, 0.04306, 0.03528,
    0.02791, 0.02112, 0.01513, 0.01016, 0.00643, 0.00412, 0.00333 },
  // W= 1.770 GeV
  { 0.29400, 0.29420, 0.29500, 0.29580, 0.29610, 0.29540, 0.29310, 0.28870, 0.28200, 0.27290,
    0.26150, 0.24830, 0.23350, 0.21780, 0.20160, 0.18550, 0.16980, 0.15480, 0.14070, 0.12760,
    0.11560, 0.10460, 0.09442, 0.08493, 0.07596, 0.06735, 0.05898, 0.05077, 0.04270, 0.03484,
    0.02732, 0.02034, 0.01413, 0.00894, 0.00503, 0.00259, 0.00177 },
  // W= 1.780 GeV
  { 0.28270, 0.28320, 0.28450, 0.28630, 0.28780, 0.28830, 0.28720, 0.28390, 0.27800, 0.26950,
    0.25850, 0.24550, 0.23080, 0.21510, 0.19890, 0.18280, 0.16710, 0.15230, 0.13850, 0.12570,
    0.11410, 0.10360, 0.09388, 0.08487, 0.07637, 0.06818, 0.06014, 0.05218, 0.04426, 0.03646,
    0.02890, 0.02182, 0.01546, 0.01012, 0.00607, 0.00354, 0.00268 },
  // W= 1.790 GeV
  { 0.27530, 0.27600, 0.27790, 0.28040, 0.28290, 0.28440, 0.28420, 0.28160, 0.27610, 0.26790,
    0.25700, 0.24380, 0.22890, 0.21300, 0.19660, 0.18040, 0.16470, 0.15000, 0.13650, 0.12420,
    0.11310, 0.10310, 0.09409, 0.08574, 0.07785, 0.07022, 0.06268, 0.05510, 0.04746, 0.03982,
    0.03233, 0.02523, 0.01880, 0.01336, 0.00921, 0.00662, 0.00573 },
  // W= 1.800 GeV
  { 0.27180, 0.27270, 0.27500, 0.27830, 0.28150, 0.28380, 0.28410, 0.28180, 0.27650, 0.26810,
    0.25690, 0.24320, 0.22780, 0.21140, 0.19470, 0.17820, 0.16250, 0.14800, 0.13480, 0.12290,
    0.11250, 0.10320, 0.09491, 0.08733, 0.08019, 0.07325, 0.06631, 0.05923, 0.05198, 0.04460,
    0.03727, 0.03024, 0.02380, 0.01832, 0.01412, 0.01148, 0.01058 },
  // W= 1.820 GeV
  { 0.27430, 0.27550, 0.27860, 0.28280, 0.28720, 0.29030, 0.29110, 0.28870, 0.28270, 0.27300,
    0.26010, 0.24470, 0.22750, 0.20960, 0.19160, 0.17440, 0.15850, 0.14410, 0.13160, 0.12090,
    0.11180, 0.10420, 0.09762, 0.09181, 0.08641, 0.08109, 0.07559, 0.06975, 0.06351, 0.05692,
    0.05015, 0.04349, 0.03727, 0.03190, 0.02773, 0.02510, 0.02419 },
  // W= 1.840 GeV
  { 0.28280, 0.28420, 0.28800, 0.29320, 0.29840, 0.30200, 0.30270, 0.29950, 0.29210, 0.28040,
    0.26520, 0.24730, 0.22790, 0.20790, 0.18850, 0.17040, 0.15420, 0.14010, 0.12830, 0.11870,
    0.11110, 0.10520, 0.10040, 0.09644, 0.09282, 0.08919, 0.08524, 0.08078, 0.07574, 0.07016,
    0.06424, 0.05824, 0.05254, 0.04755, 0.04364, 0.04115, 0.04030 },
  // W= 1.870 GeV
  { 0.28890, 0.29070, 0.29590, 0.30290, 0.30980, 0.31470, 0.31560, 0.31160, 0.30210, 0.28770,
    0.26910, 0.24790, 0.22530, 0.20290, 0.18170, 0.16260, 0.14620, 0.13260, 0.12200, 0.11410,
    0.10840, 0.10460, 0.10210, 0.10040, 0.09891, 0.09735, 0.09537, 0.09277, 0.08947, 0.08553,
    0.08112, 0.07650, 0.07201, 0.06802, 0.06486, 0.06284, 0.06215 },
  // W= 1.900 GeV
  { 0.27500, 0.27770, 0.28480, 0.29470, 0.30470, 0.31210, 0.31470, 0.31110, 0.30100, 0.28510,
    0.26460, 0.24130, 0.21700, 0.19330, 0.17140, 0.15210, 0.13610, 0.12340, 0.11390, 0.10730,
    0.10300, 0.10050, 0.09930, 0.09880, 0.09855, 0.09816, 0.09736, 0.09598, 0.09399, 0.09144,
    0.08847, 0.08532, 0.08222, 0.07946, 0.07728, 0.07589, 0.07541 },
  // W= 1.930 GeV
  { 0.24370, 0.24730, 0.25720, 0.27100, 0.28520, 0.29650, 0.30200, 0.30010, 0.29060, 0.27440,
    0.25330, 0.22930, 0.20440, 0.18040, 0.15860, 0.13990, 0.12460, 0.11280, 0.10430, 0.09853,
    0.09503, 0.09320, 0.09249, 0.09240, 0.09249, 0.09246, 0.09210, 0.09132, 0.09010, 0.08852,
    0.08671, 0.08482, 0.08301, 0.08143, 0.08021, 0.07944, 0.07918 },
  // W= 1.960 GeV
  { 0.20390, 0.20870, 0.22180, 0.24020, 0.25950, 0.27540, 0.28450, 0.28490, 0.27650, 0.26060,
    0.23930, 0.21500, 0.19000, 0.16620, 0.14490, 0.12690, 0.11240, 0.10150, 0.09364, 0.08845,
    0.08532, 0.08367, 0.08298, 0.08279, 0.08275, 0.08263, 0.08229, 0.08169, 0.08088, 0.07993,
    0.07895, 0.07804, 0.07727, 0.07669, 0.07628, 0.07606, 0.07598 },
  // W= 1.990 GeV
  { 0.16340, 0.16950, 0.18630, 0.20990, 0.23470, 0.25560, 0.26830, 0.27100, 0.26360, 0.24780,
    0.22610, 0.20140, 0.17620, 0.15250, 0.13150, 0.11410, 0.10030, 0.08991, 0.08257, 0.07769,
    0.07468, 0.07299, 0.07211, 0.07164, 0.07131, 0.07094, 0.07046, 0.06988, 0.06928, 0.06874,
    0.06837, 0.06820, 0.06824, 0.06843, 0.06868, 0.06889, 0.06896 },
  // W= 2.020 GeV
  { 0.12700, 0.13450, 0.15530, 0.18440, 0.21510, 0.24100, 0.25730, 0.26190, 0.25490, 0.23860,
    0.21600, 0.19040, 0.16450, 0.14050, 0.11960, 0.10230, 0.08885, 0.07883, 0.07174, 0.06700,
    0.06398, 0.06215, 0.06104, 0.06030, 0.05969, 0.05910, 0.05848, 0.05790, 0.05744, 0.05721,
    0.05728, 0.05767, 0.05832, 0.05911, 0.05986, 0.06039, 0.06059 },
  // W= 2.050 GeV
  { 0.09654, 0.10570, 0.13070, 0.16570, 0.20250, 0.23340, 0.25300, 0.25890, 0.25170, 0.23410,
    0.20990, 0.18280, 0.15570, 0.13090, 0.10960, 0.09222, 0.07878, 0.06883, 0.06181, 0.05706,
    0.05397, 0.05198, 0.05068, 0.04973, 0.04893, 0.04818, 0.04750, 0.04695, 0.04663, 0.04665,
    0.04708, 0.04789, 0.04901, 0.05023, 0.05135, 0.05213, 0.05242 },
  // W= 2.080 GeV
  { 0.07229, 0.08313, 0.11290, 0.15420, 0.19730, 0.23320, 0.25570, 0.26230, 0.25410, 0.23460,
    0.20810, 0.17880, 0.15000, 0.12400, 0.10190, 0.08406, 0.07038, 0.06032, 0.05320, 0.04836,
    0.04514, 0.04302, 0.04157, 0.04048, 0.03957, 0.03877, 0.03809, 0.03762, 0.03745, 0.03769,
    0.03839, 0.03953, 0.04098, 0.04254, 0.04392, 0.04488, 0.04523 },
  // W= 2.110 GeV
  { 0.05361, 0.06634, 0.10120, 0.14920, 0.19900, 0.23990, 0.26490, 0.27160, 0.26180, 0.23950,
    0.21010, 0.17810, 0.14710, 0.11950, 0.09634, 0.07785, 0.06375, 0.05341, 0.04610, 0.04110,
    0.03774, 0.03549, 0.03393, 0.03276, 0.03181, 0.03102, 0.03040, 0.03003, 0.03001, 0.03044,
    0.03137, 0.03275, 0.03445, 0.03623, 0.03781, 0.03889, 0.03928 },
  // W= 2.140 GeV
  { 0.03955, 0.05434, 0.09470, 0.15000, 0.20670, 0.25250, 0.27970, 0.28590, 0.27370, 0.24810,
    0.21520, 0.18010, 0.14660, 0.11720, 0.09272, 0.07339, 0.05873, 0.04802, 0.04046, 0.03527,
    0.03176, 0.02940, 0.02776, 0.02655, 0.02560, 0.02486, 0.02432, 0.02406, 0.02418, 0.02478,
    0.02588, 0.02744, 0.02932, 0.03126, 0.03297, 0.03414, 0.03455 },
  // W= 2.170 GeV
  { 0.02910, 0.04614, 0.09248, 0.15560, 0.21950, 0.27020, 0.29920, 0.30430, 0.28900, 0.25950,
    0.22260, 0.18410, 0.14790, 0.11650, 0.09062, 0.07036, 0.05508, 0.04397, 0.03612, 0.03072,
    0.02707, 0.02460, 0.02290, 0.02167, 0.02075, 0.02006, 0.01961, 0.01947, 0.01972, 0.02044,
    0.02168, 0.02337, 0.02537, 0.02742, 0.02922, 0.03044, 0.03088 },
  // W= 2.200 GeV
  { 0.02140, 0.04088, 0.09369, 0.16510, 0.23650, 0.29210, 0.32240, 0.32590, 0.30700, 0.27300,
    0.23180, 0.18950, 0.15050, 0.11690, 0.08965, 0.06843, 0.05252, 0.04098, 0.03284, 0.02724,
    0.02345, 0.02088, 0.01913, 0.01790, 0.01701, 0.01638, 0.01602, 0.01598, 0.01634, 0.01717,
    0.01851, 0.02030, 0.02238, 0.02450, 0.02635, 0.02762, 0.02807 },
};

//const double MAX_CStbl = 0.354;
const double MAX_CStbl = 1.0;

KMaidKpLambda::KMaidKpLambda()
 : CSTable("KMaid_K+Lambda")
{
}

KMaidKpLambda::~KMaidKpLambda()
{
}

double KMaidKpLambda::CS( double w, double cost ) const
{
  if( w > 2.200 ){ w = 2.200; }
  if( cost>1. ){ cost = 1.; }
  if( cost<-1. ){ cost = -1.; }
  if( w <= Wtbl[0] ) return 0.0;

  // w search
  int iw=0;
  while( w>Wtbl[iw] ) ++iw;
  // cost search
  int ic=0;
  while( cost<Costtbl[ic] ) ++ic;

  //////////////////////////////////////////
  // Wtbl[iw-1] < w <= Wtbl[iw]           //
  // Costtbl[ic-1] <= cost < Costtbl[ic]  //
  //////////////////////////////////////////

  // linear interporation

  double dw=1./(Wtbl[iw]-Wtbl[iw-1]);
  double ww1=dw*(Wtbl[iw]-w), ww2=dw*(w-Wtbl[iw-1]);
  double dc=1./(Costtbl[ic]-Costtbl[ic-1]);
  double wc1=dc*(Costtbl[ic]-cost), wc2=dc*(cost-Costtbl[ic-1]);
  double cs = CStbl[iw-1][ic-1]*ww1*wc1+CStbl[iw-1][ic]*ww1*wc2+CStbl[iw][ic-1]*ww2*wc1+CStbl[iw][ic]*ww2*wc2;
  cs /= MAX_CStbl; // normalized fact

  return cs;

}
				       
